{% extends "admin/default.html" %}
{% block content %}
{% load static %}
{% load site_tags %}
{% get_segment3 segment3 request.path_info %}


<div class="content-wrapper">
	<form method="POST" autocomplete="off" action="{% url 'settings.updatePrefix' key %}" enctype="multipart/form-data" class="mws-form">
	<section class="content-header">
		<h1>
			{{segment3}} Settings
		</h1>
		<ol class="breadcrumb">
			<li><a href="{% url 'dashboard.index' %}"><i class="fa fa-dashboard"></i> Dashboard</a></li>
			<li class="active">	{{segment3}} Settings</li>
		</ol>
	</section>
	<section class="content"> 
			{% csrf_token %}
			<div class="row pad rowWrapFlex">
				{% for result in results%}
					<input type="hidden" value="{{result.id}}" name="{{result.id}}"  />
					{% if result.input_type == 'text' %}
						<div class="col-md-6">
							<div class="form-group">
								<label class="mws-form-label">{{result.title}}<span class="requireRed"> * </span></label>
								<input type="text" value="{{result.value}}" name="{{result.key}}" id="{{result.key}}" placeholder="{{result.title}}" class="form-control valid" />
								<div class="error-message help-inline"></div>
							</div>
						</div>
					{% elif result.input_type == 'textarea' %}
						<div class="col-md-6">
							<div class="form-group">
								<label class="mws-form-label">{{result.title}}<span class="requireRed"> * </span></label>
								<textarea class="form-control description valid" id="{{result.key}}" rows="3" name="{{result.key}}" >{{result.value}}</textarea>
								<div class="error-message help-inline"></div>
							</div>
						</div>
					{% elif result.input_type == 'checkbox' %}
						<div class="col-md-6">
							<div class="form-group">
								<label class="mws-form-label">{{result.title}}<span class="requireRed"> * </span></label>
								<div class="mws-form-item">
									<input type="checkbox" value= "1" name="{{result.key}}" {% if result.value == "1" %} checked="checked" {% endif %} >
								</div>
							</div> 
						</div> 
					{% elif result.input_type == 'file' %}
						<div class="col-md-6">
							<div class="form-group">
								<input type="file" name="{{result.key}}" value="{{result.value}}"/>
								{% if result.value %}
									<div class="image_box">
										<a class="fancybox-buttons" data-fancybox-group="button" href="{{settings.SETTING_IMAGE_URL}}{{result.value}}">
											<img height="100" width="100" accept="image/*"  src="{{settings.SETTING_IMAGE_URL}}{{result.value}}"/>
										</a>
										<a href="javascript:void(0);" onclick="removeProfilePhoto(this,'{{result.id}}');" class="btn btn-danger " title="delete"> 
											<span class="fa fa-times"></span>
										</a>		
									</div>
								{% endif %}
							</div>
						</div>
					{% endif %}
				{% endfor %}
			</div>
			<div class="row pad"></div>
				<div class="col-md-12">
					<div class="mws-button-row">
						<div class="input" >
							<button type="button" onclick="submit_form();" class="btn btn-success">Submit</button>
							<a href="{% url 'settings.prefix' key%}" class="btn btn-primary"><i class=\"icon-refresh\"></i> Reset</a>
							<p id="demo"></p>
						</div>
					</div>
				</div>
			</div>
	</section>
	</form>
</div>
<link rel="stylesheet" href="{%  static 'admin/css/jquery.fancybox.css' %}">
<script src="{%  static 'admin/js/jquery.fancybox.js' %}"></script>

<script>
	$(function(){
		$('.fancybox').fancybox();
		$('.fancybox-buttons').fancybox({
			openEffect  : 'none',
			closeEffect : 'none',
			prevEffect : 'none',
			nextEffect : 'none',
		});
	});
</script>
<script>
  function removeProfilePhoto(e,id){
		bootbox.confirm("Are you sure want to delete this image ?",
		function(result){
			if(result){
				if(id !=''){
					$.ajax({	
						url: '{% url "settings.delete_image" %}',
						data: {
						  'id': id 
						},
						dataType: 'json',
						success: function (data) {
						  	if (data.success) {
								$(e).parents('.image_box').remove();
						  	}else{
								alert("There is an error. Please try again letter."); 
						  	}
						}
				  });
				}
			}
		});
	}

	function isEmail(email) {
	  var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	  return regex.test(email);
	}

	var empty_msg				=	'This field is required';
	var numuric_empty_msg		=	'This field is allow only numuric value';
	var image_validation		=	'Please upload a valid image. Valid extensions are jpg, jpeg, png, jpeg';
	var allowedExtensions		=	['gif','GIF','jpeg','JPEG','PNG','png','jpg','JPG'];
	function submit_form() {
		var $inputs = $('.mws-form :input.valid');
		var error  =	0;
		$inputs.each(function() { 
			if($(this).val().trim() == '' ){
				$(this).next().html(empty_msg);
				error	=	1;
			}else {
				if($(this).attr('id') == 'Site.email' ){
					if(!isEmail($(this).val().trim())) { 
						$(this).next().html("Please enter a valid email");
						error	=	1;
					}else {
						$(this).next().html("");
					}
				}else if($(this).attr('id') == 'Reading.recordPerPage' || $(this).attr('id') == 'Site.websiteCommission' || $(this).attr('id') == 'Site.phone'){
					if(!$.isNumeric($(this).val().trim())){
						$(this).next().html(numuric_empty_msg);
						error	=	1;
					}else {
						$(this).next().html("");
					}
				}else {
					$(this).next().html("");
				}
			}
		});
		if(error == 0){
			$('.mws-form').submit();
		}
	}
	$('#settingsForm').each(function() {
		$(this).find('input').keypress(function(e) {
           if(e.which == 10 || e.which == 13) {
				submit_form();
				return false;
            }
        });
	});
</script>
{% endblock %}
